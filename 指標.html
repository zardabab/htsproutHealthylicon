<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±è€•è¨ˆç•«å§”å“¡æœƒ - äº’å‹•å¼æŒ‡æ¨™å„€è¡¨æ¿ (å·²ä¿®æ­£ KPI é¡¯ç¤º)</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f6f9;
            color: #333;
        }
        .dashboard-header {
            background-color: #0078d4 !important; /* Power BI Blue */
        }
        .section-title {
            border-bottom: 2px solid #ddd;
            margin: 20px 0 15px;
            padding-bottom: 5px;
        }
        .section-title h2 {
            color: #005a9e;
            font-size: 20px;
            margin: 0;
        }
        /* KPI ç¯„ç–‡æ¨™é¡Œæ¨£å¼ */
        .kpi-category-title {
            background-color: #e3f2fd; 
            color: #005a9e;
            padding: 8px 15px;
            margin-bottom: 10px;
            margin-top: 15px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 18px;
            width: 100%; 
        }
        /* KPI å¡ç‰‡å®¹å™¨ */
        .card-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .kpi-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            width: calc(33.33% - 10px); /* èª¿æ•´ç‚ºä¸‰å¼µå¡ç‰‡ä¸€è¡Œ */
            min-width: 280px; /* æœ€å°å¯¬åº¦ç¢ºä¿æ‰‹æ©Ÿä¸Šä¸æœƒå¤ªå° */
            box-sizing: border-box;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        .kpi-card h4 {
            color: #555; /* èª¿æ•´æ¨™é¡Œé¡è‰²ï¼Œå¼·èª¿é”æˆç‡ */
            margin-top: 5px;
            font-size: 15px;
            min-height: 30px; 
            font-weight: normal;
        }
        /* KPI ä¸»è¦æ•¸å€¼ï¼šé”æˆç‡ç™¾åˆ†æ¯” */
        .kpi-value {
            font-size: 28px; 
            font-weight: bold;
            color: #0078d4; /* é”æˆç‡ä½¿ç”¨ä¸»è¦è—è‰² */
            margin-top: 5px;
            margin-bottom: 5px;
        }
        .kpi-target-info {
            font-size: 12px;
            color: #888;
            border-top: 1px solid #eee;
            padding-top: 5px;
            margin-top: 5px;
        }
        /* é€²åº¦æ¢èª¿æ•´ï¼šè®Šé«˜ã€é¡è‰²å’Œåœ“è§’ */
        .progress-bar-container {
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 6px;
            margin-bottom: 10px; /* ç§»åˆ°æœ€ä¸Šæ–¹ */
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            transition: width 0.5s ease-in-out;
            border-radius: 6px;
        }

        /* çµ±ä¸€åœ–è¡¨/è¡¨æ ¼å¡ç‰‡æ¨£å¼ */
        .chart-card, .data-table-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
        }
        .chart-card h3, .data-table-card h3 {
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 18px;
        }
        /* è¡¨æ ¼å„ªåŒ– */
        #recruitment-table td, #finance-personnel-table td {
            vertical-align: middle;
        }
        .tab-content {
            min-height: 500px;
        }
        /* ç¢ºä¿ Chart.js å®¹å™¨åœ¨ h-100 æ™‚èƒ½å¤ æ­£ç¢ºä½”ç”¨ç©ºé–“ */
        .chart-card canvas {
            max-height: 300px; /* é™åˆ¶åœ–è¡¨æœ€å¤§é«˜åº¦ï¼Œé¿å…éé«˜ */
        }
    </style>
</head>
<body>
    
    <div class="dashboard-header bg-primary text-white p-4 shadow-sm">
        <h1 class="mb-0">ğŸŒ± æ·±è€•è¨ˆç•«å§”å“¡æœƒ - äº’å‹•å¼æŒ‡æ¨™å„€è¡¨æ¿</h1>
        <p class="mb-0 opacity-75">è³‡æ–™æ›´æ–°æ™‚é–“: 2025/11/25</p>
    </div>

    <div class="container-fluid p-4">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="kpi-tab" data-bs-toggle="tab" data-bs-target="#kpi" type="button" role="tab" aria-controls="kpi" aria-selected="true">
                    âœ¨ ç¸¾æ•ˆæ¦‚è¦½ (KPI)
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="recruitment-tab" data-bs-toggle="tab" data-bs-target="#recruitment" type="button" role="tab" aria-controls="recruitment" aria-selected="false">
                    ğŸ‘¥ äººåŠ›æ‹›å‹Ÿ
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="finance-tab" data-bs-toggle="tab" data-bs-target="#finance" type="button" role="tab" aria-controls="finance" aria-selected="false">
                    ğŸ’° ç¶“è²»é ä¼°
                </button>
            </li>
        </ul>

        <div class="tab-content pt-3" id="myTabContent">
            
            <div class="tab-pane fade show active" id="kpi" role="tabpanel" aria-labelledby="kpi-tab">
                <div class="section-title"><h2>é—œéµç¸¾æ•ˆæŒ‡æ¨™ (KPI) - å¹´åº¦ç›®æ¨™é”æˆæ¦‚æ³</h2></div>
                <div id="kpi-container">
                    </div>
            </div>

            <div class="tab-pane fade" id="recruitment" role="tabpanel" aria-labelledby="recruitment-tab">
                <div class="section-title"><h2>äººåŠ›æ‹›å‹Ÿæƒ…å½¢</h2></div>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="chart-card shadow-sm h-100 p-3">
                            <h3>äººåŠ›ç¸½è¦½</h3>
                            <canvas id="recruitment-overview-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="data-table-card shadow-sm h-100 p-3">
                            <h3>è·å‹™ç¼ºé¡æ˜ç´°</h3>
                            <div class="table-responsive">
                                <table id="recruitment-table" class="table table-hover table-bordered">
                                    <thead>
                                        <tr><th>è·ç¨±</th><th>ç·¨åˆ¶</th><th>ç¾æœ‰</th><th>ç¼ºé¡</th></tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="finance" role="tabpanel" aria-labelledby="finance-tab">
                <div class="section-title"><h2>ç¶“è²»é ä¼°èˆ‡åˆ†æ</h2></div>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="chart-card shadow-sm h-100 p-3">
                            <h3>ç¶“è²»é …ç›®ä½”ç¸½é ç®—ä½”æ¯”</h3>
                            <canvas id="finance-breakdown-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-8">
                         <div class="data-table-card shadow-sm h-100 p-3">
                            <h3>äººäº‹è²»ç”¨æ˜ç´° (å¹´åº¦)</h3>
                            <div class="table-responsive">
                                <table id="finance-personnel-table" class="table table-hover table-bordered table-sm">
                                    <thead>
                                        <tr><th>è·ç¨±</th><th>ç·¨åˆ¶äººæ•¸</th><th>æœˆå–®åƒ¹</th><th class="text-end">å¹´åº¦å°è¨ˆ</th></tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // --- æ•¸æ“šæ¨¡æ“¬ (å¼·èª¿å››å¤§ç¯„ç–‡å’Œåƒ…å¹´åº¦æ•¸æ“š) ---

            const kpiData = [
                {
                    category: "ä¸€ã€æå‡é†«ç™‚æœå‹™å“è³ªèˆ‡æ•ˆç‡", 
                    name: "å¤šå…ƒçé…¬æ”¶å…¥", definition: "(1-1-1) >5%",
                    currentYear: 0.015, targetYear: 0.05,
                },
                {
                    category: "ä¸€ã€æå‡é†«ç™‚æœå‹™å“è³ªèˆ‡æ•ˆç‡", 
                    name: "æµå‹•å·¥æ™‚", definition: "(1-1-2) >5%",
                    currentYear: 0.02, targetYear: 0.05,
                },
                {
                    category: "äºŒã€å„ªåŒ–è½‰éŠœæµç¨‹èˆ‡è³‡è¨Šæ•´åˆ", 
                    name: "è½‰éŠœæµç¨‹è³‡è¨ŠåŒ–", definition: "æ¸›å°‘å·¥ä½œæ™‚æ•¸ 15%",
                    currentYear: 0.05, targetYear: 0.15,
                },
                {
                    category: "ä¸‰ã€è¦åŠƒå¤šå…ƒäººæ‰åŸ¹è¨“èˆ‡ç•™ä»»", 
                    name: "ç§‘æŠ€ç…§æœå“¡èªè­‰", definition: "åˆ¶åº¦æ­£å¼ä¸Šç·š",
                    currentYear: "æœªå»ºç½®", targetYear: "å»ºç½®å®Œæˆ",
                },
                {
                    category: "å››ã€æ“´å¤§å¥åº·ç…§è­·ç§‘æŠ€æ‡‰ç”¨", 
                    name: "å¥åº·é›²å¹³å°æ‡‰ç”¨é …æ•¸", definition: "æ“´å¤§æ‡‰ç”¨ 4é …",
                    currentYear: 1, targetYear: 4,
                },
                {
                    category: "å››ã€æ“´å¤§å¥åº·ç…§è­·ç§‘æŠ€æ‡‰ç”¨", 
                    name: "AI å‹•ä½œåˆ†æå°å…¥æ“šé»æ•¸", definition: "å°å…¥ 3å€‹æ“šé»",
                    currentYear: 0, targetYear: 3,
                },
                {
                    category: "ä¸€ã€æå‡é†«ç™‚æœå‹™å“è³ªèˆ‡æ•ˆç‡", 
                    name: "ç—…æ‚£æ»¿æ„åº¦", definition: "ç¶­æŒ >90%",
                    currentYear: 0.88, targetYear: 0.90,
                },
            ];
            
            // äººåŠ›æ‹›å‹Ÿæ•¸æ“š (ä¿æŒä¸è®Š)
            const recruitmentRawData = [
                { title: "è³‡è¨Šç¶“ç†", total: 1, current: 1, gap: 0 },
                { title: "è³‡è¨Šå°ˆå“¡", total: 1, current: 0, gap: 1 },
                { title: "è¨ˆç•«ç®¡ç†å¸«", total: 2, current: 0, gap: 2 },
                { title: "äººè³‡å°ˆå“¡", total: 1, current: 1, gap: 0 },
                { title: "ç ”ç©¶åŠ©ç†", total: 5, current: 3, gap: 2 },
                { title: "è·èƒ½/ç‰©ç†æ²»ç™‚å¸«", total: 5, current: 1, gap: 4 },
                { title: "è­·ç†ç£å°", total: 1, current: 1, gap: 0 },
                { title: "å€‹ç®¡å¸«", total: 4, current: 2, gap: 2 },
                { title: "ç‡Ÿé¤Šå¸«", total: 1, current: 0, gap: 1 },
                { title: "ç¤¾å·¥", total: 1, current: 0, gap: 1 },
                { title: "å¿ƒç†å¸«", total: 1, current: 0, gap: 1 },
                { title: "å¸æ©Ÿ", total: 2, current: 0, gap: 2 }
            ];

            // ç¶“è²»é ä¼°æ•¸æ“š (ä¿æŒä¸è®Š)
            const personnelDetailData = [
                { title: "è³‡è¨Šç¶“ç†", total: 1, monthlyPrice: 75000, subtotal: 1012500 },
                { title: "è³‡è¨Šå°ˆå“¡", total: 1, monthlyPrice: 45000, subtotal: 607500 },
                { title: "è¨ˆç•«ç®¡ç†å¸«", total: 2, monthlyPrice: 42000, subtotal: 1134000 },
                { title: "äººè³‡å°ˆå“¡", total: 1, monthlyPrice: 40000, subtotal: 540000 },
                { title: "ç ”ç©¶åŠ©ç†", total: 5, monthlyPrice: 40000, subtotal: 2700000 },
                { title: "è·èƒ½/ç‰©ç†æ²»ç™‚å¸«", total: 5, monthlyPrice: 55000, subtotal: 3712500 },
                { title: "è­·ç†ç£å°", total: 1, monthlyPrice: 65000, subtotal: 877500 },
                { title: "å€‹ç®¡å¸«", total: 4, monthlyPrice: 40000, subtotal: 2160000 },
                { title: "ç‡Ÿé¤Šå¸«", total: 1, monthlyPrice: 40000, subtotal: 540000 },
                { title: "ç¤¾å·¥", total: 1, monthlyPrice: 40000, subtotal: 540000 },
                { title: "å¿ƒç†å¸«", total: 1, monthlyPrice: 40000, subtotal: 540000 },
                { title: "å¸æ©Ÿ", total: 2, monthlyPrice: 35000, subtotal: 945000 }
            ];
            
            const totalPersonnelCost = 17531500;
            const totalBudget = 25000000; 
            const otherCost = totalBudget - totalPersonnelCost;

            const financeData = {
                totalBudget: totalBudget, 
                personnelCost: totalPersonnelCost,
                otherCost: otherCost, 
                personnelDetail: personnelDetailData
            };
            
            // æ ¼å¼åŒ–é‡‘é¡ (åŠ å…¥åƒåˆ†ä½)
            function formatCurrency(num) {
                if (num === undefined || num === null) return 'N/A';
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }

            // --- ç¸¾æ•ˆæ¦‚è¦½ (KPI) æ¸²æŸ“ (æ›´æ–°ï¼šå¼·èª¿ç™¾åˆ†æ¯”èˆ‡é€²åº¦æ¢åœ¨ä¸Š) ---

            function generateKpiCard(kpi) {
                const value = kpi.currentYear;
                const target = kpi.targetYear;
                
                let isStatus = typeof target === 'string'; // åˆ¤æ–·æ˜¯å¦ç‚ºã€Œå»ºç½®å®Œæˆã€ç­‰ç‹€æ…‹é¡æŒ‡æ¨™
                let progressHtml = '';
                let achievementText = 'N/A';
                let targetInfoText = '';
                let barColor = '#4a4a4a'; // é è¨­ç°è‰²

                if (isStatus) {
                    // ç‹€æ…‹é¡æŒ‡æ¨™ (å¦‚ï¼šå»ºç½®å®Œæˆ)
                    const isAchieved = value === target;
                    achievementText = isAchieved ? `<span style="color:#107c10;">âœ” ${target}</span>` : `<span style="color:#e81123;">âœ˜ ${value}</span>`;
                    targetInfoText = `ç‹€æ…‹ç›®æ¨™: ${target}`;
                    
                    const displayProgress = isAchieved ? 100 : 30; // æœªå®Œæˆæ™‚é€²åº¦æ¢é¡¯ç¤º30%ä½œç‚ºé€²è¡Œä¸­
                    barColor = isAchieved ? '#107c10' : '#ffb900';

                    progressHtml = `
                        <div class="progress-bar-container" title="ç‹€æ…‹: ${isAchieved ? 'å·²é”æˆ' : 'é€²è¡Œä¸­'}">
                            <div class="progress-bar-fill" style="width: ${displayProgress}%; background-color: ${barColor};"></div>
                        </div>
                    `;

                } else {
                    // æ•¸å€¼é¡æŒ‡æ¨™
                    const progressValue = (value / target) * 100;
                    const displayProgress = Math.min(progressValue, 100);
                    
                    const isPercentageTarget = target < 1;
                    
                    if (isPercentageTarget) {
                        targetInfoText = `ç¾æ³/ç›®æ¨™: ${(value * 100).toFixed(1)}% / ${(target * 100).toFixed(1)}%`;
                    } else {
                        targetInfoText = `ç¾æ³/ç›®æ¨™: ${value} / ${target}`;
                    }
                    
                    // é”æˆç‡æ–‡å­—
                    achievementText = `${displayProgress.toFixed(1)}%`;
                    
                    // é€²åº¦æ¢é¡è‰²åˆ¤æ–·
                    barColor = displayProgress >= 100 ? '#107c10' : (displayProgress >= 80 ? '#0078d4' : (displayProgress >= 50 ? '#ffb900' : '#e81123'));

                    progressHtml = `
                        <div class="progress-bar-container" title="é”æˆç‡: ${displayProgress.toFixed(1)}%">
                            <div class="progress-bar-fill" style="width: ${displayProgress}%; background-color: ${barColor};"></div>
                        </div>
                    `;
                }

                return `
                    <div class="kpi-card">
                        ${progressHtml}
                        <div class="kpi-value" style="color: ${barColor};">${achievementText}</div>
                        <h4>${kpi.name}</h4>
                        <div class="kpi-target-info">
                            ${targetInfoText}<br>
                            <span style="color: #666; font-style: italic;">å®šç¾©: ${kpi.definition}</span>
                        </div>
                    </div>
                `;
            }

            function renderKpiCards() {
                const $kpiContainer = $('#kpi-container');
                $kpiContainer.empty();
                
                const groupedKpis = kpiData.reduce((acc, kpi) => {
                    const category = kpi.category || "æœªåˆ†é¡";
                    if (!acc[category]) {
                        acc[category] = [];
                    }
                    acc[category].push(kpi);
                    return acc;
                }, {});

                for (const category in groupedKpis) {
                    $kpiContainer.append(`<div class="kpi-category-title">${category}</div>`);
                    
                    // åªéœ€ä¸€å€‹å¡ç‰‡å®¹å™¨ï¼Œæ¯å€‹ KPI åªéœ€è¦ä¸€å€‹å¡ç‰‡ï¼ˆå¹´åº¦ç›®æ¨™ï¼‰
                    const $cardContainer = $('<div class="card-container"></div>');
                    
                    groupedKpis[category].forEach(kpi => {
                        // åªæ¸²æŸ“å¹´åº¦ç›®æ¨™å¡ç‰‡
                        $cardContainer.append(generateKpiCard(kpi));
                    });

                    $kpiContainer.append($cardContainer);
                }
            }

            // --- åœ–è¡¨å¯¦ä¾‹ç®¡ç† ---
            let recruitmentChartInstance = null;
            let financeChartInstance = null;

            // --- äººåŠ›æ‹›å‹Ÿæ¸²æŸ“ ---
            function renderRecruitment() {
                // ... (æ­¤éƒ¨åˆ†é‚è¼¯ä¿æŒä¸è®Šï¼Œèˆ‡ä¸Šä¸€å€‹ç‰ˆæœ¬ç›¸åŒ)
                let totalHeadcount = 0;
                let totalCurrent = 0;
                let totalGap = 0;
                
                const $recruitmentTableBody = $('#recruitment-table tbody');
                $recruitmentTableBody.empty();

                recruitmentRawData.forEach(item => {
                    totalHeadcount += item.total;
                    totalCurrent += item.current;
                    totalGap += item.gap;

                    const tableRow = `
                        <tr>
                            <td>${item.title}</td>
                            <td>${item.total}</td>
                            <td>${item.current}</td>
                            <td class="fw-bold" style="color: ${item.gap > 0 ? 'red' : 'green'};">${item.gap}</td>
                        </tr>
                    `;
                    $recruitmentTableBody.append(tableRow);
                });

                const ctx = document.getElementById('recruitment-overview-chart').getContext('2d');
                if (recruitmentChartInstance) {
                    recruitmentChartInstance.destroy();
                }

                recruitmentChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['ç¾æœ‰äººæ•¸', 'ç¼ºé¡'],
                        datasets: [{
                            label: 'äººåŠ›ç¸½è¦½',
                            data: [totalCurrent, totalGap],
                            backgroundColor: ['#107c10', '#e81123'],
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            title: {
                                display: true,
                                text: `ç¸½ç·¨åˆ¶: ${totalHeadcount}äºº (æ‹›å‹Ÿç‡: ${(totalCurrent / totalHeadcount * 100).toFixed(1)}%)`
                            }
                        }
                    }
                });
            }

            // --- ç¶“è²»é ä¼°æ¸²æŸ“ ---
            function renderFinance() {
                // ... (æ­¤éƒ¨åˆ†é‚è¼¯ä¿æŒä¸è®Šï¼Œèˆ‡ä¸Šä¸€å€‹ç‰ˆæœ¬ç›¸åŒ)
                const ctxBreakdown = document.getElementById('finance-breakdown-chart').getContext('2d');
                if (financeChartInstance) {
                    financeChartInstance.destroy();
                }

                const personnelPercentage = (financeData.personnelCost / financeData.totalBudget) * 100;
                const otherPercentage = (financeData.otherCost / financeData.totalBudget) * 100;

                financeChartInstance = new Chart(ctxBreakdown, {
                    type: 'pie',
                    data: {
                        labels: [`äººäº‹è²» (${personnelPercentage.toFixed(1)}%)`, `å…¶ä»–è²»ç”¨ (${otherPercentage.toFixed(1)}%)`],
                        datasets: [{
                            data: [financeData.personnelCost, financeData.otherCost],
                            backgroundColor: ['#0078d4', '#ffb900'], 
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            title: {
                                display: true,
                                text: `ç¸½é ç®—: NT$ ${formatCurrency(financeData.totalBudget)}`
                            },
                            tooltip: {
                                 callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += `NT$ ${formatCurrency(context.parsed)}`;
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });

                const $financeTableBody = $('#finance-personnel-table tbody');
                $financeTableBody.empty();
                
                let tableTotalCost = 0;

                financeData.personnelDetail.forEach(item => {
                    tableTotalCost += item.subtotal;
                    const tableRow = `
                        <tr>
                            <td>${item.title}</td>
                            <td>${item.total} äºº</td>
                            <td>NT$ ${formatCurrency(item.monthlyPrice)}</td>
                            <td class="text-end">NT$ ${formatCurrency(item.subtotal)}</td>
                        </tr>
                    `;
                    $financeTableBody.append(tableRow);
                });
                
                const totalRow = `
                    <tr class="table-primary fw-bold">
                        <td colspan="3" class="text-end">äººäº‹è²»ç¸½è¨ˆ (ç¶“å¸¸é–€)</td>
                        <td class="text-end">NT$ ${formatCurrency(tableTotalCost)}</td>
                    </tr>
                `;
                $financeTableBody.append(totalRow);
            }

            // --- å•Ÿå‹•æ¸²æŸ“èˆ‡ Tab äº’å‹• (ä¿æŒä¸Šä¸€æ¬¡ä¿®æ­£çš„é‚è¼¯) ---
            
            renderKpiCards();
            renderRecruitment();
            renderFinance();

            const tabEl = document.getElementById('myTab');
            tabEl.addEventListener('shown.bs.tab', function (event) {
                const targetId = event.target.getAttribute('data-bs-target');
                
                setTimeout(() => {
                    if (targetId === '#recruitment' && recruitmentChartInstance) {
                        recruitmentChartInstance.resize();
                    } 
                    
                    if (targetId === '#finance' && financeChartInstance) {
                        financeChartInstance.resize();
                    }
                }, 10); 
            });
        });
    </script>
</body>
</html>