<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±è€•è¨ˆç•«å§”å“¡æœƒ - äº’å‹•å¼æŒ‡æ¨™å„€è¡¨æ¿ (å·²ä¿®æ­£ KPI é¡¯ç¤º)</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f6f9;
            color: #333;
        }
        .dashboard-header {
            background-color: #0078d4 !important; /* Power BI Blue */
        }
        .section-title {
            border-bottom: 2px solid #ddd;
            margin: 20px 0 15px;
            padding-bottom: 5px;
        }
        .section-title h2 {
            color: #005a9e;
            font-size: 20px;
            margin: 0;
        }
        /* KPI ç¯„ç–‡æ¨™é¡Œæ¨£å¼ */
        .kpi-category-title {
            background-color: #e3f2fd; 
            color: #005a9e;
            padding: 8px 15px;
            margin-bottom: 10px;
            margin-top: 15px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 18px;
            width: 100%; 
        }
        /* KPI å¡ç‰‡å®¹å™¨ */
        .card-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .kpi-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            width: calc(33.33% - 10px); /* èª¿æ•´ç‚ºä¸‰å¼µå¡ç‰‡ä¸€è¡Œ */
            min-width: 280px; /* æœ€å°å¯¬åº¦ç¢ºä¿æ‰‹æ©Ÿä¸Šä¸æœƒå¤ªå° */
            box-sizing: border-box;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        .kpi-card h4 {
            color: #555; /* èª¿æ•´æ¨™é¡Œé¡è‰²ï¼Œå¼·èª¿é”æˆç‡ */
            margin-top: 5px;
            font-size: 15px;
            min-height: 30px; 
            font-weight: normal;
        }
        /* KPI ä¸»è¦æ•¸å€¼ï¼šé”æˆç‡ç™¾åˆ†æ¯” */
        .kpi-value {
            font-size: 28px; 
            font-weight: bold;
            color: #0078d4; /* é”æˆç‡ä½¿ç”¨ä¸»è¦è—è‰² */
            margin-top: 5px;
            margin-bottom: 5px;
        }
        .kpi-target-info {
            font-size: 12px;
            color: #888;
            border-top: 1px solid #eee;
            padding-top: 5px;
            margin-top: 5px;
        }
        /* é€²åº¦æ¢èª¿æ•´ï¼šè®Šé«˜ã€é¡è‰²å’Œåœ“è§’ */
        .progress-bar-container {
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 6px;
            margin-bottom: 10px; /* ç§»åˆ°æœ€ä¸Šæ–¹ */
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            transition: width 0.5s ease-in-out;
            border-radius: 6px;
        }

        /* çµ±ä¸€åœ–è¡¨/è¡¨æ ¼å¡ç‰‡æ¨£å¼ */
        .chart-card, .data-table-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
        }
        .chart-card h3, .data-table-card h3 {
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 18px;
        }
        /* è¡¨æ ¼å„ªåŒ– */
        #recruitment-table td, #finance-personnel-table td {
            vertical-align: middle;
        }
        .tab-content {
            min-height: 500px;
        }
        /* ç¢ºä¿ Chart.js å®¹å™¨åœ¨ h-100 æ™‚èƒ½å¤ æ­£ç¢ºä½”ç”¨ç©ºé–“ */
        .chart-card canvas {
            max-height: 300px; /* é™åˆ¶åœ–è¡¨æœ€å¤§é«˜åº¦ï¼Œé¿å…éé«˜ */
        }
    </style>
</head>
<body>
    
    <div class="dashboard-header bg-primary text-white p-4 shadow-sm">
        <h1 class="mb-0">ğŸŒ± æ·±è€•è¨ˆç•«å§”å“¡æœƒ - äº’å‹•å¼æŒ‡æ¨™å„€è¡¨æ¿</h1>
        <p class="mb-0 opacity-75">è³‡æ–™æ›´æ–°æ™‚é–“: 2025/11/25</p>
    </div>

    <div class="container-fluid p-4">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="kpi-tab" data-bs-toggle="tab" data-bs-target="#kpi" type="button" role="tab" aria-controls="kpi" aria-selected="true">
                    âœ¨ ç¸¾æ•ˆæ¦‚è¦½ (KPI)
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="recruitment-tab" data-bs-toggle="tab" data-bs-target="#recruitment" type="button" role="tab" aria-controls="recruitment" aria-selected="false">
                    ğŸ‘¥ äººåŠ›æ‹›å‹Ÿ
                </button>
            </li>
            <li class="nav-item" role="presentation" style="display: none;">
                <button class="nav-link" id="finance-tab" data-bs-toggle="tab" data-bs-target="#finance" type="button" role="tab" aria-controls="finance" aria-selected="false">
                    ğŸ’° ç¶“è²»é ä¼°
                </button>
            </li>
        </ul>

        <div class="tab-content pt-3" id="myTabContent">
            
            <div class="tab-pane fade show active" id="kpi" role="tabpanel" aria-labelledby="kpi-tab">
                <div class="section-title"><h2>é—œéµç¸¾æ•ˆæŒ‡æ¨™ (KPI) - å¹´åº¦ç›®æ¨™é”æˆæ¦‚æ³</h2></div>
                <div id="kpi-container">
                    </div>
            </div>

            <div class="tab-pane fade" id="recruitment" role="tabpanel" aria-labelledby="recruitment-tab">
                <div class="section-title"><h2>äººåŠ›æ‹›å‹Ÿæƒ…å½¢</h2></div>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="chart-card shadow-sm h-100 p-3">
                            <h3>äººåŠ›ç¸½è¦½</h3>
                            <canvas id="recruitment-overview-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="data-table-card shadow-sm h-100 p-3">
                            <h3>è·å‹™ç¼ºé¡æ˜ç´°</h3>
                            <div class="table-responsive">
                                <table id="recruitment-table" class="table table-hover table-bordered">
                                    <thead>
                                        <tr><th>è·ç¨±</th><th>ç·¨åˆ¶</th><th>ç¾æœ‰</th><th>ç¼ºé¡</th></tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="finance" role="tabpanel" aria-labelledby="finance-tab">
                <div class="section-title"><h2>ç¶“è²»é ä¼°èˆ‡åˆ†æ</h2></div>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="chart-card shadow-sm h-100 p-3">
                            <h3>ç¶“è²»é …ç›®ä½”ç¸½é ç®—ä½”æ¯”</h3>
                            <canvas id="finance-breakdown-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-8">
                         <div class="data-table-card shadow-sm h-100 p-3">
                            <h3>äººäº‹è²»ç”¨æ˜ç´° (å¹´åº¦)</h3>
                            <div class="table-responsive">
                                <table id="finance-personnel-table" class="table table-hover table-bordered table-sm">
                                    <thead>
                                        <tr><th>è·ç¨±</th><th>ç·¨åˆ¶äººæ•¸</th><th>æœˆå–®åƒ¹</th><th class="text-end">å¹´åº¦å°è¨ˆ</th></tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // --- æ•¸æ“šæ¨¡æ“¬ (å¼·èª¿å››å¤§ç¯„ç–‡å’Œåƒ…å¹´åº¦æ•¸æ“š) ---

            const kpiData = [
                {
                    category: "ä¸€ã€å„ªåŒ–é†«ç™‚å·¥ä½œæ¢ä»¶", 
                    name: "å¤šå…ƒçé…¬æ”¶å…¥", definition: "(1-1-1) å…¶ä»–æ”¶å…¥/å€‹äººç›®å‰æ”¶å…¥ >5% | è² è²¬äºº: é™³ä¿Šä¼äººè³‡",
                    currentYear: 0, targetYear: 0.05,
                },
                {
                    category: "ä¸€ã€å„ªåŒ–é†«ç™‚å·¥ä½œæ¢ä»¶", 
                    name: "æµå‹•å·¥æ™‚", definition: "(1-1-2) æ¥­å¤–å°ˆæ¡ˆæœå‹™å·¥æ™‚/æ¯æœˆå·¥æ™‚ >5% | è² è²¬äºº: é™³ä¿Šä¼äººè³‡",
                    currentYear: 0, targetYear: 0.05,
                },
                {
                    category: "ä¸€ã€å„ªåŒ–é†«ç™‚å·¥ä½œæ¢ä»¶", 
                    name: "è½‰éŠœæµç¨‹è³‡è¨ŠåŒ–", definition: "(1-2-1) å»ºç«‹æ•¸ä½æ¨™æº–åŒ–è½‰ä»‹æµç¨‹ï¼Œæ¸›å°‘å·¥ä½œæ™‚æ•¸ 15% | è² è²¬äºº: å¤ç‘é„‰ç£å°",
                    currentYear: 0, targetYear: 0.15,
                },
                {
                    category: "äºŒã€è¦åŠƒå¤šå…ƒäººæ‰åŸ¹è¨“", 
                    name: "èªè­‰èª²ç¨‹åˆ¶åº¦ä¸Šç·š", definition: "(2-1-1) é€éèªè­‰èª²ç¨‹åˆ¶åº¦æ­£å¼ä¸Šç·šï¼Œå­¸ç¿’æˆæ•ˆè¿½è¹¤ç²¾æº–åº¦ï¼Œç¢ºä¿åŸ¹è‚²å°ˆæ¥­äººæ‰ç¬¦åˆèªè­‰æ¨™æº– | è² è²¬äºº: é™³ä¿Šä¼äººè³‡",
                    currentYear: 0, targetYear: 1.00,
                },
                {
                    category: "äºŒã€è¦åŠƒå¤šå…ƒäººæ‰åŸ¹è¨“", 
                    name: "å²¡å±±å¥åº·é›²å¹³å°æ‡‰ç”¨", definition: "(2-2-1) æ“´å¤§ã€Œå²¡å±±å¥åº·é›²ã€å¹³å°æ‡‰ç”¨ï¼Œæ•´åˆç—…æ­·ã€å¾©å¥é€²åº¦ã€å®¶å±¬å›é¥‹èˆ‡ç¤¾å€è³‡æºï¼Œæå‡åé„‰åœ°å€æ•¸ä½é†«ç™‚æœå‹™çš„å¯è¿‘æ€§ã€æ•´åˆæ€§èˆ‡æ•ˆç‡ | è² è²¬äºº: å¤ç‘é„‰ç£å°",
                    currentYear: 0, targetYear: 1.00,
                },
                {
                    category: "ä¸‰ã€å°å…¥æ™ºæ…§ç§‘æŠ€é†«ç™‚", 
                    name: "AIå¥åº·ç…§é¡§æ–¹æ¡ˆæ•¸", definition: "(3-1-1) AIç”Ÿæˆå¥åº·ç…§é¡§æ–¹æ¡ˆæ•¸ (ç—…ç¨®åˆ†é¡ã€å¹´é½¡åˆ†é¡ã€ç…§æœå“¡ã€ç—…äººã€å®¶å±¬) | è² è²¬äºº: æ¥Šæ™ºå‚‘è³‡è¨Šç¶“ç†",
                    currentYear: 0, targetYear: 1.00,
                },
                {
                    category: "ä¸‰ã€å°å…¥æ™ºæ…§ç§‘æŠ€é†«ç™‚", 
                    name: "ç”Ÿå‘½å¾µè±¡æ•¸æ“šä¸Šå‚³æˆåŠŸç‡", definition: "(3-2-1) ç”Ÿå‘½å¾µè±¡æ•¸æ“šä¸Šå‚³æˆåŠŸç‡ (ä¸Šå‚³æ¯”æ•¸/æ¸¬é‡æ¯”æ•¸æ•¸æ“šå‚³è¼¸æˆåŠŸæ¯”ä¾‹%) | è² è²¬äºº: æ¥Šæ™ºå‚‘è³‡è¨Šç¶“ç†",
                    currentYear: 0, targetYear: 0.95,
                },
                {
                    category: "ä¸‰ã€å°å…¥æ™ºæ…§ç§‘æŠ€é†«ç™‚", 
                    name: "å‡ºé™¢ç—…äººéŠœæ¥æœå‹™ç‡", definition: "(3-3-1) å‡ºé™¢ç—…äººéŠœæ¥ç¤ºç¯„ä¸­å¿ƒæœå‹™ (æ¥å—ç¤ºç¯„ä¸­å¿ƒæœå‹™äººæ•¸/å‡ºé™¢ç—…äººæ•¸) | è² è²¬äºº: å¤ç‘é„‰ç£å°",
                    currentYear: 0, targetYear: 0.80,
                },
                {
                    category: "ä¸‰ã€å°å…¥æ™ºæ…§ç§‘æŠ€é†«ç™‚", 
                    name: "å€‹ç®¡æœå‹™æ•ˆç‡æå‡", definition: "(3-4-1) å‡ºé™¢æº–å‚™æœå‹™å€‹ç®¡æœå‹™è§£é‡‹æ™‚é–“æ¯”ç‡ (AIä»‹å…¥å‰å¾Œå€‹ç®¡å¹³å‡æœå‹™è§£é‡‹æ™‚é–“å·®/åŸæœå‹™æ™‚é–“) | è² è²¬äºº: å¤ç‘é„‰ç£å°",
                    currentYear: 0, targetYear: 0.30,
                },
                {
                    category: "å››ã€ç¤¾æœƒè²¬ä»»é†«ç™‚æ°¸çºŒ", 
                    name: "å®Œæˆè½‰ä»‹äººæ•¸", definition: "(4-1-1) å®Œæˆè½‰ä»‹äººæ•¸ (è½‰å…¥ã€è½‰å‡ºã€ç¤¾å€ã€ä¸­å¿ƒã€é†«é™¢) | è² è²¬äºº: å³å®œæ³°ç ”ç©¶åŠ©ç†",
                    currentYear: 0, targetYear: 1.00,
                },
                {
                    category: "å››ã€ç¤¾æœƒè²¬ä»»é†«ç™‚æ°¸çºŒ", 
                    name: "åé„‰å±…æ°‘å·¡è¿´é†«ç™‚æœå‹™æ¯”ä¾‹", definition: "(4-2-1) æ¥å—å·¡è¿´è»Šæˆ–é è·è¨ºç™‚åé„‰å±…æ°‘æ¯”ä¾‹ | è² è²¬äºº: å³å®œæ³°ç ”ç©¶åŠ©ç†",
                    currentYear: 0, targetYear: 0.60,
                },
                {
                    category: "å››ã€ç¤¾æœƒè²¬ä»»é†«ç™‚æ°¸çºŒ", 
                    name: "è¨ˆç•«ç…§é¡§æ¨¡å¼å—ç…§äººæ•¸", definition: "(4-3-1) æ¥å—è¨ˆç•«ç…§é¡§æ¨¡å¼çš„äººæ•¸ | è² è²¬äºº: æ¥Šæ™ºå‚‘è³‡è¨Šç¶“ç†",
                    currentYear: 0, targetYear: 1.00,
                },
                {
                    category: "å››ã€ç¤¾æœƒè²¬ä»»é†«ç™‚æ°¸çºŒ", 
                    name: "ç…§é¡§æœå‹™äººå“¡åŸ¹è¨“æ¯”ä¾‹", definition: "(4-4-1) æŠ•å…¥ç…§é¡§æœå‹™äººå“¡/æ¥å—åŸ¹è¨“äººå“¡ | è² è²¬äºº: é™³ä¿Šä¼äººè³‡",
                    currentYear: 0, targetYear: 0.90,
                },
                {
                    category: "å››ã€ç¤¾æœƒè²¬ä»»é†«ç™‚æ°¸çºŒ", 
                    name: "PACå†å…¥é™¢ç‡", definition: "(4-5-1) åŒä¸€ç–¾ç—…(PAC)å¹´åº¦å…§å†å…¥é™¢æ¬¡æ•¸/åŒä¸€ç–¾ç—…(PAC)å¹´åº¦ç¸½å°±é†«æ¬¡æ•¸ | è² è²¬äºº: è·èƒ½-é‚±è“®æ¨º",
                    currentYear: 0, targetYear: 0.15,
                },
                {
                    category: "å››ã€ç¤¾æœƒè²¬ä»»é†«ç™‚æ°¸çºŒ", 
                    name: "ç¢³æ’æŒ‡æ¨™çµ±è¨ˆæ•¸é‡", definition: "(4-6-1) ç¢³æ’çµ±è¨ˆèˆ‡ç›¸é—œç¢³æ’æŒ‡æ¨™æ•¸é‡ | è² è²¬äºº: ---",
                    currentYear: 0, targetYear: 1.00,
                },
                {
                    category: "å››ã€ç¤¾æœƒè²¬ä»»é†«ç™‚æ°¸çºŒ", 
                    name: "æ°¸çºŒå§”å“¡æœƒæœƒè­°æ¬¡æ•¸", definition: "(4-7-1) å¬é–‹æ°¸çºŒç™¼å±•å§”å“¡æœƒæœƒè­°æ¬¡æ•¸ (ä»¥ç°½åˆ°è¡¨æˆ–æœƒè­°ç´€éŒ„ç‚ºæ†‘) | è² è²¬äºº: ---",
                    currentYear: 0, targetYear: 1.00,
                },
                {
                    category: "å››ã€ç¤¾æœƒè²¬ä»»é†«ç™‚æ°¸çºŒ", 
                    name: "æ°¸çºŒç™¼å±•å ±å‘Šæ›¸", definition: "(4-7-2) ç™¼ä½ˆæ°¸çºŒç™¼å±•å ±å‘Šæ›¸ | è² è²¬äºº: ---",
                    currentYear: 0, targetYear: 1.00,
                },
                {
                    category: "å››ã€ç¤¾æœƒè²¬ä»»é†«ç™‚æ°¸çºŒ", 
                    name: "ç´¯è¨ˆåˆä½œæ©Ÿæ§‹å®¶æ•¸", definition: "(4-8-1) ç´¯è¨ˆåˆä½œæ©Ÿæ§‹å®¶æ•¸ | è² è²¬äºº: å¤ç‘é„‰ç£å°",
                    currentYear: 0, targetYear: 1.00,
                },
            ];
            
            // äººåŠ›æ‹›å‹Ÿæ•¸æ“š (ä¿æŒä¸è®Š)
            const recruitmentRawData = [
                { title: "è³‡è¨Šç¶“ç†", total: 1, current: 1, gap: 0 },
                { title: "è³‡è¨Šå°ˆå“¡", total: 1, current: 0, gap: 1 },
                { title: "è¨ˆç•«ç®¡ç†å¸«", total: 2, current: 0, gap: 2 },
                { title: "äººè³‡å°ˆå“¡", total: 1, current: 1, gap: 0 },
                { title: "ç ”ç©¶åŠ©ç†", total: 5, current: 3, gap: 2 },
                { title: "è·èƒ½/ç‰©ç†æ²»ç™‚å¸«", total: 5, current: 1, gap: 4 },
                { title: "è­·ç†ç£å°", total: 1, current: 1, gap: 0 },
                { title: "å€‹ç®¡å¸«", total: 4, current: 2, gap: 2 },
                { title: "ç‡Ÿé¤Šå¸«", total: 1, current: 0, gap: 1 },
                { title: "ç¤¾å·¥", total: 1, current: 0, gap: 1 },
                { title: "å¿ƒç†å¸«", total: 1, current: 0, gap: 1 },
                { title: "å¸æ©Ÿ", total: 2, current: 0, gap: 2 }
            ];

            // ç¶“è²»é ä¼°æ•¸æ“š (ä¿æŒä¸è®Š)
            const personnelDetailData = [
                { title: "è³‡è¨Šç¶“ç†", total: 1, monthlyPrice: 75000, subtotal: 1012500 },
                { title: "è³‡è¨Šå°ˆå“¡", total: 1, monthlyPrice: 45000, subtotal: 607500 },
                { title: "è¨ˆç•«ç®¡ç†å¸«", total: 2, monthlyPrice: 42000, subtotal: 1134000 },
                { title: "äººè³‡å°ˆå“¡", total: 1, monthlyPrice: 40000, subtotal: 540000 },
                { title: "ç ”ç©¶åŠ©ç†", total: 5, monthlyPrice: 40000, subtotal: 2700000 },
                { title: "è·èƒ½/ç‰©ç†æ²»ç™‚å¸«", total: 5, monthlyPrice: 55000, subtotal: 3712500 },
                { title: "è­·ç†ç£å°", total: 1, monthlyPrice: 65000, subtotal: 877500 },
                { title: "å€‹ç®¡å¸«", total: 4, monthlyPrice: 40000, subtotal: 2160000 },
                { title: "ç‡Ÿé¤Šå¸«", total: 1, monthlyPrice: 40000, subtotal: 540000 },
                { title: "ç¤¾å·¥", total: 1, monthlyPrice: 40000, subtotal: 540000 },
                { title: "å¿ƒç†å¸«", total: 1, monthlyPrice: 40000, subtotal: 540000 },
                { title: "å¸æ©Ÿ", total: 2, monthlyPrice: 35000, subtotal: 945000 }
            ];
            
            const totalPersonnelCost = 17531500;
            const totalBudget = 25000000; 
            const otherCost = totalBudget - totalPersonnelCost;

            const financeData = {
                totalBudget: totalBudget, 
                personnelCost: totalPersonnelCost,
                otherCost: otherCost, 
                personnelDetail: personnelDetailData
            };
            
            // æ ¼å¼åŒ–é‡‘é¡ (åŠ å…¥åƒåˆ†ä½)
            function formatCurrency(num) {
                if (num === undefined || num === null) return 'N/A';
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }

            // --- ç¸¾æ•ˆæ¦‚è¦½ (KPI) æ¸²æŸ“ (æ›´æ–°ï¼šå¼·èª¿ç™¾åˆ†æ¯”èˆ‡é€²åº¦æ¢åœ¨ä¸Š) ---

            function generateKpiCard(kpi) {
                const value = kpi.currentYear;
                const target = kpi.targetYear;
                
                let isStatus = typeof target === 'string'; // åˆ¤æ–·æ˜¯å¦ç‚ºã€Œå»ºç½®å®Œæˆã€ç­‰ç‹€æ…‹é¡æŒ‡æ¨™
                let progressHtml = '';
                let achievementText = 'N/A';
                let targetInfoText = '';
                let barColor = '#4a4a4a'; // é è¨­ç°è‰²

                if (isStatus) {
                    // ç‹€æ…‹é¡æŒ‡æ¨™ (å¦‚ï¼šå»ºç½®å®Œæˆ)
                    const isAchieved = value === target;
                    achievementText = isAchieved ? `<span style="color:#107c10;">âœ” ${target}</span>` : `<span style="color:#e81123;">âœ˜ ${value}</span>`;
                    targetInfoText = `ç‹€æ…‹ç›®æ¨™: ${target}`;
                    
                    const displayProgress = isAchieved ? 100 : 30; // æœªå®Œæˆæ™‚é€²åº¦æ¢é¡¯ç¤º30%ä½œç‚ºé€²è¡Œä¸­
                    barColor = isAchieved ? '#107c10' : '#ffb900';

                    progressHtml = `
                        <div class="progress-bar-container" title="ç‹€æ…‹: ${isAchieved ? 'å·²é”æˆ' : 'é€²è¡Œä¸­'}">
                            <div class="progress-bar-fill" style="width: ${displayProgress}%; background-color: ${barColor};"></div>
                        </div>
                    `;

                } else {
                    // æ•¸å€¼é¡æŒ‡æ¨™
                    const progressValue = (value / target) * 100;
                    const displayProgress = Math.min(progressValue, 100);
                    
                    const isPercentageTarget = target < 1;
                    
                    if (isPercentageTarget) {
                        targetInfoText = `ç¾æ³/ç›®æ¨™: ${(value * 100).toFixed(1)}% / ${(target * 100).toFixed(1)}%`;
                    } else {
                        targetInfoText = `ç¾æ³/ç›®æ¨™: ${value} / ${target}`;
                    }
                    
                    // é”æˆç‡æ–‡å­—
                    achievementText = `${displayProgress.toFixed(1)}%`;
                    
                    // é€²åº¦æ¢é¡è‰²åˆ¤æ–·
                    barColor = displayProgress >= 100 ? '#107c10' : (displayProgress >= 80 ? '#0078d4' : (displayProgress >= 50 ? '#ffb900' : '#e81123'));

                    progressHtml = `
                        <div class="progress-bar-container" title="é”æˆç‡: ${displayProgress.toFixed(1)}%">
                            <div class="progress-bar-fill" style="width: ${displayProgress}%; background-color: ${barColor};"></div>
                        </div>
                    `;
                }

                // æå–è² è²¬äººè³‡è¨Š
                const definitionParts = kpi.definition.split(' | è² è²¬äºº: ');
                const mainDefinition = definitionParts[0];
                const responsiblePerson = definitionParts[1] || 'æœªæŒ‡å®š';

                return `
                    <div class="kpi-card">
                        <h3 style="
                            color: #fff;
                            font-size: 16px; 
                            font-weight: 700; 
                            font-family: 'Segoe UI', 'Arial', sans-serif;
                            margin-bottom: 12px; 
                            margin-top: 0; 
                            line-height: 1.3;
                            letter-spacing: 1px;
                            position: relative;
                            padding: 12px 20px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            border-radius: 15px;
                            box-shadow: 
                                0 8px 32px rgba(102, 126, 234, 0.3),
                                0 0 0 1px rgba(255, 255, 255, 0.1),
                                inset 0 1px 0 rgba(255, 255, 255, 0.2);
                            animation: slideInGlow 0.8s ease-out forwards, pulseGlow 2s ease-in-out infinite alternate;
                            transform: translateY(-20px);
                            opacity: 0;
                            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
                            overflow: hidden;
                        ">
                            <span style="
                                position: relative;
                                z-index: 2;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                            ">
                                <span style="
                                    display: inline-block;
                                    animation: bounce 2s ease-in-out infinite;
                                ">ğŸš€</span>
                                ${kpi.name}
                            </span>
                            <div style="
                                position: absolute;
                                top: 0;
                                left: -100%;
                                width: 100%;
                                height: 100%;
                                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
                                animation: shimmer 3s ease-in-out infinite;
                            "></div>
                        </h3>
                        <style>
                            @keyframes slideInGlow {
                                0% { 
                                    transform: translateY(-30px) scale(0.8);
                                    opacity: 0;
                                    filter: blur(10px);
                                }
                                50% { 
                                    transform: translateY(-5px) scale(1.05);
                                    opacity: 0.7;
                                    filter: blur(2px);
                                }
                                100% { 
                                    transform: translateY(0) scale(1);
                                    opacity: 1;
                                    filter: blur(0);
                                }
                            }
                            @keyframes pulseGlow {
                                0% { 
                                    box-shadow: 
                                        0 8px 32px rgba(102, 126, 234, 0.3),
                                        0 0 0 1px rgba(255, 255, 255, 0.1),
                                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
                                }
                                100% { 
                                    box-shadow: 
                                        0 12px 40px rgba(102, 126, 234, 0.5),
                                        0 0 0 1px rgba(255, 255, 255, 0.2),
                                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
                                }
                            }
                            @keyframes shimmer {
                                0% { left: -100%; }
                                50% { left: 100%; }
                                100% { left: 100%; }
                            }
                            @keyframes bounce {
                                0%, 100% { transform: translateY(0) rotate(0deg); }
                                25% { transform: translateY(-3px) rotate(-5deg); }
                                75% { transform: translateY(-1px) rotate(5deg); }
                            }
                        </style>
                        ${progressHtml}
                        <div style="font-size: 14px; color: #666; margin-bottom: 3px;">ç›®å‰é€²åº¦:</div>
                        <div class="kpi-value" style="color: ${barColor};">${achievementText}</div>
                        <div class="kpi-target-info">
                            ${targetInfoText}<br>
                            <span style="color: #666; font-style: italic;">å®šç¾©: ${mainDefinition}</span><br>
                            <span style="color: #0078d4; font-weight: bold; background-color: #f0f8ff; padding: 2px 6px; border-radius: 3px; font-size: 11px;">ğŸ‘¤ ${responsiblePerson}</span>
                        </div>
                    </div>
                `;
            }

            function renderKpiCards() {
                const $kpiContainer = $('#kpi-container');
                $kpiContainer.empty();
                
                const groupedKpis = kpiData.reduce((acc, kpi) => {
                    const category = kpi.category || "æœªåˆ†é¡";
                    if (!acc[category]) {
                        acc[category] = [];
                    }
                    acc[category].push(kpi);
                    return acc;
                }, {});

                for (const category in groupedKpis) {
                    $kpiContainer.append(`<div class="kpi-category-title">${category}</div>`);
                    
                    // åªéœ€ä¸€å€‹å¡ç‰‡å®¹å™¨ï¼Œæ¯å€‹ KPI åªéœ€è¦ä¸€å€‹å¡ç‰‡ï¼ˆå¹´åº¦ç›®æ¨™ï¼‰
                    const $cardContainer = $('<div class="card-container"></div>');
                    
                    groupedKpis[category].forEach(kpi => {
                        // åªæ¸²æŸ“å¹´åº¦ç›®æ¨™å¡ç‰‡
                        $cardContainer.append(generateKpiCard(kpi));
                    });

                    $kpiContainer.append($cardContainer);
                }
            }

            // --- åœ–è¡¨å¯¦ä¾‹ç®¡ç† ---
            let recruitmentChartInstance = null;
            let financeChartInstance = null;

            // --- äººåŠ›æ‹›å‹Ÿæ¸²æŸ“ ---
            function renderRecruitment() {
                // ... (æ­¤éƒ¨åˆ†é‚è¼¯ä¿æŒä¸è®Šï¼Œèˆ‡ä¸Šä¸€å€‹ç‰ˆæœ¬ç›¸åŒ)
                let totalHeadcount = 0;
                let totalCurrent = 0;
                let totalGap = 0;
                
                const $recruitmentTableBody = $('#recruitment-table tbody');
                $recruitmentTableBody.empty();

                recruitmentRawData.forEach(item => {
                    totalHeadcount += item.total;
                    totalCurrent += item.current;
                    totalGap += item.gap;

                    const tableRow = `
                        <tr>
                            <td>${item.title}</td>
                            <td>${item.total}</td>
                            <td>${item.current}</td>
                            <td class="fw-bold" style="color: ${item.gap > 0 ? 'red' : 'green'};">${item.gap}</td>
                        </tr>
                    `;
                    $recruitmentTableBody.append(tableRow);
                });

                const ctx = document.getElementById('recruitment-overview-chart').getContext('2d');
                if (recruitmentChartInstance) {
                    recruitmentChartInstance.destroy();
                }

                recruitmentChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['ç¾æœ‰äººæ•¸', 'ç¼ºé¡'],
                        datasets: [{
                            label: 'äººåŠ›ç¸½è¦½',
                            data: [totalCurrent, totalGap],
                            backgroundColor: ['#107c10', '#e81123'],
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            title: {
                                display: true,
                                text: `ç¸½ç·¨åˆ¶: ${totalHeadcount}äºº (æ‹›å‹Ÿç‡: ${(totalCurrent / totalHeadcount * 100).toFixed(1)}%)`
                            }
                        }
                    }
                });
            }

            // --- ç¶“è²»é ä¼°æ¸²æŸ“ ---
            function renderFinance() {
                // ... (æ­¤éƒ¨åˆ†é‚è¼¯ä¿æŒä¸è®Šï¼Œèˆ‡ä¸Šä¸€å€‹ç‰ˆæœ¬ç›¸åŒ)
                const ctxBreakdown = document.getElementById('finance-breakdown-chart').getContext('2d');
                if (financeChartInstance) {
                    financeChartInstance.destroy();
                }

                const personnelPercentage = (financeData.personnelCost / financeData.totalBudget) * 100;
                const otherPercentage = (financeData.otherCost / financeData.totalBudget) * 100;

                financeChartInstance = new Chart(ctxBreakdown, {
                    type: 'pie',
                    data: {
                        labels: [`äººäº‹è²» (${personnelPercentage.toFixed(1)}%)`, `å…¶ä»–è²»ç”¨ (${otherPercentage.toFixed(1)}%)`],
                        datasets: [{
                            data: [financeData.personnelCost, financeData.otherCost],
                            backgroundColor: ['#0078d4', '#ffb900'], 
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            title: {
                                display: true,
                                text: `ç¸½é ç®—: NT$ ${formatCurrency(financeData.totalBudget)}`
                            },
                            tooltip: {
                                 callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += `NT$ ${formatCurrency(context.parsed)}`;
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });

                const $financeTableBody = $('#finance-personnel-table tbody');
                $financeTableBody.empty();
                
                let tableTotalCost = 0;

                financeData.personnelDetail.forEach(item => {
                    tableTotalCost += item.subtotal;
                    const tableRow = `
                        <tr>
                            <td>${item.title}</td>
                            <td>${item.total} äºº</td>
                            <td>NT$ ${formatCurrency(item.monthlyPrice)}</td>
                            <td class="text-end">NT$ ${formatCurrency(item.subtotal)}</td>
                        </tr>
                    `;
                    $financeTableBody.append(tableRow);
                });
                
                const totalRow = `
                    <tr class="table-primary fw-bold">
                        <td colspan="3" class="text-end">äººäº‹è²»ç¸½è¨ˆ (ç¶“å¸¸é–€)</td>
                        <td class="text-end">NT$ ${formatCurrency(tableTotalCost)}</td>
                    </tr>
                `;
                $financeTableBody.append(totalRow);
            }

            // --- å•Ÿå‹•æ¸²æŸ“èˆ‡ Tab äº’å‹• (ä¿æŒä¸Šä¸€æ¬¡ä¿®æ­£çš„é‚è¼¯) ---
            
            renderKpiCards();
            renderRecruitment();
            renderFinance();

            const tabEl = document.getElementById('myTab');
            tabEl.addEventListener('shown.bs.tab', function (event) {
                const targetId = event.target.getAttribute('data-bs-target');
                
                setTimeout(() => {
                    if (targetId === '#recruitment' && recruitmentChartInstance) {
                        recruitmentChartInstance.resize();
                    } 
                    
                    if (targetId === '#finance' && financeChartInstance) {
                        financeChartInstance.resize();
                    }
                }, 10); 
            });
        });
    </script>
</body>
</html>