<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>巴氏量表評估</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8f4f8 100%);
        }
        
        .assessment-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            margin-bottom: 2rem;
        }
        
        .version-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .assessment-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .scoring-item {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            border-left: 5px solid #667eea;
        }
        
        .score-radio {
            margin: 1rem 0;
        }
        
        .score-radio input[type="radio"] {
            margin-right: 0.5rem;
        }
        
        .total-score-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            margin-top: 2rem;
        }
        
        .score-value {
            font-size: 3rem;
            font-weight: bold;
        }
        
        .interpretation {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        
        .btn-group-custom {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .back-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .back-nav a {
            border-radius: 8px;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }
        
        .back-nav a:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container-fluid px-4 py-4">
        <div class="back-nav">
            <a href="量表系統.html" class="btn btn-outline-secondary"><i class="fas fa-list me-2"></i>量表列表</a>
            <a href="AI個案管理名單.html" class="btn btn-outline-primary"><i class="fas fa-users me-2"></i>個案名單</a>
        </div>
        
        <div class="assessment-header">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h1><i class="fas fa-wheelchair me-3"></i>巴氏日常生活活動量表</h1>
                    <h5 class="mt-2 opacity-75">Barthel Index (BI)</h5>
                    <div class="version-info">
                        <strong>版本：v1.0</strong> | 滿分：100 分 | 評估類型：<span id="assessmentType">初評</span>
                    </div>
                </div>
                <div>
                    <button class="btn btn-light" onclick="window.history.back()"><i class="fas fa-times fs-5"></i></button>
                </div>
            </div>
        </div>
        
        <div class="assessment-card">
            <h3 class="mb-4"><i class="fas fa-info-circle me-2"></i>量表說明</h3>
            <p>巴氏日常生活活動量表（Barthel Index）是一個簡單、可靠的評估工具，用於評估個案在十項基本日常生活活動中的獨立程度。</p>
            <p class="text-muted">評估項目包括：進食、梳洗、穿衣、如廁、排尿、排便、移動、上下樓梯、洗澡等。</p>
        </div>
        
        <form id="barthel-form">
            <div class="assessment-card">
                <h4 class="mb-4">評估項目</h4>
                
                <div class="scoring-item">
                    <h5>1. 進食 <span class="badge bg-primary">0 / 5 / 10分</span></h5>
                    <div class="score-radio">
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="feeding" value="0" id="feeding0" checked>
                            <label class="form-check-label" for="feeding0">完全無法進食 (0分)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="feeding" value="5" id="feeding5">
                            <label class="form-check-label" for="feeding5">需要協助 (5分)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="feeding" value="10" id="feeding10">
                            <label class="form-check-label" for="feeding10">可獨立進食 (10分)</label>
                        </div>
                    </div>
                </div>
                
                <div class="scoring-item">
                    <h5>2. 梳洗 <span class="badge bg-primary">0 / 5分</span></h5>
                    <div class="score-radio">
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="grooming" value="0" id="grooming0" checked>
                            <label class="form-check-label" for="grooming0">需要全部協助 (0分)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="grooming" value="5" id="grooming5">
                            <label class="form-check-label" for="grooming5">可獨立完成 (5分)</label>
                        </div>
                    </div>
                </div>
                
                <div class="scoring-item">
                    <h5>3. 穿衣 <span class="badge bg-primary">0 / 5 / 10分</span></h5>
                    <div class="score-radio">
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="dressing" value="0" id="dressing0" checked>
                            <label class="form-check-label" for="dressing0">完全無法穿衣 (0分)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="dressing" value="5" id="dressing5">
                            <label class="form-check-label" for="dressing5">需要協助 (5分)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="dressing" value="10" id="dressing10">
                            <label class="form-check-label" for="dressing10">可獨立穿衣 (10分)</label>
                        </div>
                    </div>
                </div>
                
                <div class="scoring-item">
                    <h5>4. 如廁 <span class="badge bg-primary">0 / 5 / 10分</span></h5>
                    <div class="score-radio">
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="toileting" value="0" id="toileting0" checked>
                            <label class="form-check-label" for="toileting0">完全無法自理 (0分)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="toileting" value="5" id="toileting5">
                            <label class="form-check-label" for="toileting5">需要協助 (5分)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="toileting" value="10" id="toileting10">
                            <label class="form-check-label" for="toileting10">可獨立自理 (10分)</label>
                        </div>
                    </div>
                </div>
                
                <div class="scoring-item">
                    <h5>5. 排便控制 <span class="badge bg-primary">0 / 5 / 10分</span></h5>
                    <div class="score-radio">
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="bowels" value="0" id="bowels0" checked>
                            <label class="form-check-label" for="bowels0">失禁 (0分)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="bowels" value="5" id="bowels5">
                            <label class="form-check-label" for="bowels5">偶爾失禁 (5分)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input barthel-input" type="radio" name="bowels" value="10" id="bowels10">
                            <label class="form-check-label" for="bowels10">能控制 (10分)</label>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <div class="total-score-box">
                <h4>總分</h4>
                <div class="score-value" id="totalScore">0</div>
                <div class="interpretation">
                    <strong>判讀結果：</strong> <span id="interpretation">-</span>
                </div>
            </div>
            
            <div class="btn-group-custom">
                <button type="button" class="btn btn-primary" onclick="calculateScore()">
                    <i class="fas fa-calculator me-2"></i>計算分數
                </button>
                <button type="button" class="btn btn-success" onclick="saveAssessment()">
                    <i class="fas fa-save me-2"></i>儲存評估
                </button>
                <button type="button" class="btn btn-warning" onclick="resetForm()">
                    <i class="fas fa-redo me-2"></i>重新開始
                </button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 解析 URL 參數
            const urlParams = new URLSearchParams(window.location.search);
            const stage = urlParams.get('stage') || '初評';
            document.getElementById('assessmentType').textContent = stage;
            
            // 添加 change 事件監聽器以實時更新分數
            document.querySelectorAll('.barthel-input').forEach(input => {
                input.addEventListener('change', calculateScore);
            });
            
            // 初始計算分數
            calculateScore();
        });
        
        function calculateScore() {
            let total = 0;
            const items = {};
            
            // 獲取所有 radio 按鈕的值
            document.querySelectorAll('input[type="radio"]').forEach(input => {
                const name = input.name;
                if (input.checked) {
                    items[name] = parseInt(input.value);
                }
            });
            
            // 計算總分
            for (let key in items) {
                total += items[key];
            }
            
            document.getElementById('totalScore').textContent = total;
            
            // 顯示判讀結果
            let interpretation = '';
            if (total >= 90) {
                interpretation = '獨立生活能力良好 (獨立或輕微協助)';
            } else if (total >= 61) {
                interpretation = '輕度依賴 (部分協助)';
            } else if (total >= 41) {
                interpretation = '中度依賴 (需要相當協助)';
            } else if (total >= 21) {
                interpretation = '重度依賴 (需要大量協助)';
            } else {
                interpretation = '全面依賴 (需要全部協助)';
            }
            
            document.getElementById('interpretation').textContent = interpretation;
            
            // 輸出調試信息
            console.log('計算結果:', {total, items});
        }
        
        function saveAssessment() {
            const total = document.getElementById('totalScore').textContent;
            alert(`評估已儲存！\n巴氏量表評分：${total}分\n\n此功能將連接到後端資料庫保存。`);
        }
        
        function resetForm() {
            document.getElementById('barthel-form').reset();
            // 找出每個 radio 群組的第一個選項（通常是 0 分）
            document.querySelectorAll('input[type="radio"][value="0"]').forEach(input => {
                input.checked = true;
            });
            calculateScore();
        }
    </script>
</body>
</html>
